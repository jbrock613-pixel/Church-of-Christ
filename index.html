<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Church of Christ Bible Study Asst</title>
    <style>
        /* ... (existing CSS unchanged from your previous file) ... */
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸ“– Church of Christ Bible Study Assistant</h1>
            <p>"Speaking where the Bible speaks, silent where the Bible is silent"</p>
        </div>

        <div class="chat-container" id="chatContainer">
            <div class="message bot-message">
                <div class="bubble">
                    Welcome! I'm here to help with your Bible study and sermon preparation. I follow the New Testament pattern and emphasize Scripture as our sole authority. How may I assist you today?
                </div>
            </div>
        </div>

        <div class="typing-indicator" id="typingIndicator">
            The assistant is thinking...
        </div>

        <div class="quick-actions">
            <h3>Quick Topics:</h3>
            <div class="action-buttons">
                <button class="action-btn" onclick="quickAction('salvation')">Plan of Salvation</button>
                <button class="action-btn" onclick="quickAction('baptism')">Baptism</button>
                <button class="action-btn" onclick="quickAction('worship')">New Testament Worship</button>
                <button class="action-btn" onclick="quickAction('organization')">Church Organization</button>
                <button class="action-btn" onclick="quickAction('communion')">Lord's Supper</button>
                <button class="action-btn" onclick="showWebReferences()">Web Resources</button>
            </div>
        </div>

        <div class="input-container">
            <div class="input-wrapper">
                <input type="text" id="userInput" placeholder="Ask a Bible question or request study help..." 
                       onkeypress="handleKeyPress(event)">
                <button id="sendBtn" onclick="sendMessage()">Send</button>
            </div>
        </div>
    </div>

    <!-- Scripture Reference Modal -->
    <div class="scripture-modal" id="scriptureModal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeScriptureModal()">&times;</span>
            <div id="scriptureContent"></div>
        </div>
    </div>

    <script>
        // Core chatbot configuration with Church of Christ doctrine
        const botConfig = {
            // Key doctrinal positions
            doctrines: {
                salvation: {
                    steps: ['Hear (Romans 10:17)', 'Believe (John 8:24)', 'Repent (Acts 2:38)', 
                            'Confess (Romans 10:9-10)', 'Be Baptized (Acts 2:38)', 'Live Faithfully (Revelation 2:10)'],
                    keyVerses: ['Acts 2:38', 'Mark 16:16', 'Romans 6:3-4', 'Galatians 3:27', '1 Peter 3:21']
                },
                baptism: {
                    purpose: 'For remission of sins (Acts 2:38)',
                    mode: 'Immersion only (Romans 6:4)',
                    subjects: 'Believers who can understand the gospel'
                },
                worship: {
                    elements: ['Singing (Ephesians 5:19)', 'Prayer (1 Thessalonians 5:17)', 
                              'Preaching (2 Timothy 4:2)', 'Communion (Acts 20:7)', 'Giving (1 Corinthians 16:1-2)'],
                    music: 'A cappella only - no instruments'
                },
                organization: {
                    structure: 'Autonomous congregations with elders and deacons',
                    leadership: ['Elders (1 Timothy 3:1-7)', 'Deacons (1 Timothy 3:8-13)', 'Evangelists (2 Timothy 4:5)']
                }
            },

            // Scripture database (key verses only for instant lookup, now with full API support)
            scriptures: {
                'Acts 2:38': 'Then Peter said unto them, Repent, and be baptized every one of you in the name of Jesus Christ for the remission of sins, and ye shall receive the gift of the Holy Ghost.',
                'Mark 16:16': 'He that believeth and is baptized shall be saved; but he that believeth not shall be damned.',
                'Romans 6:3-4': 'Know ye not, that so many of us as were baptized into Jesus Christ were baptized into his death? Therefore we are buried with him by baptism into death...',
                'Galatians 3:27': 'For as many of you as have been baptized into Christ have put on Christ.',
                'Ephesians 5:19': 'Speaking to yourselves in psalms and hymns and spiritual songs, singing and making melody in your heart to the Lord.',
                '1 Peter 3:21': 'The like figure whereunto even baptism doth also now save us...',
                'Romans 10:17': 'So then faith cometh by hearing, and hearing by the word of God.',
                'John 8:24': 'I said therefore unto you, that ye shall die in your sins: for if ye believe not that I am he, ye shall die in your sins.'
            },

            // Web reference pages for external trusted resources
            referencePages: [
                { title: "Church of Christ Overview", url: "https://en.wikipedia.org/wiki/Churches_of_Christ" },
                { title: "What Must I Do To Be Saved?", url: "https://www.churchofchrist.com/what-must-i-do-to-be-saved/" },
                { title: "History of the Church of Christ", url: "https://www.christiancourier.com/articles/144-history-of-the-church-of-christ" }
                { title: "History of the Church of Christ", url: "https://www.aburningfire.net}
            ],

            // Response patterns based on keywords
            responsePatterns: {
                'salvation': 'provideSalvationPlan',
                'baptism': 'explainBaptism',
                'music': 'explainWorship',
                'instrument': 'explainAcappella',
                'elder': 'explainOrganization',
                'divorce': 'explainDivorce',
                'communion': 'explainCommunion',
                'lord\'s supper': 'explainCommunion'
            }
        };

        // Main response generation engine
        class BibleAssistant {
            constructor(config) {
                this.config = config;
                this.conversationHistory = [];
            }

            // Process user input and generate appropriate response
            async processMessage(userInput) {
                const lowercaseInput = userInput.toLowerCase();
                for (const [keyword, handler] of Object.entries(this.config.responsePatterns)) {
                    if (lowercaseInput.includes(keyword)) {
                        return this[handler]();
                    }
                }
                // Default to general Bible study help
                return this.provideGeneralHelp(userInput);
            }

            provideSalvationPlan() {
                let response = "According to the New Testament pattern, here are the steps of salvation:\n\n";
                this.config.doctrines.salvation.steps.forEach((step, index) => {
                    response += `${index + 1}. ${step}\n`;
                });
                response += "\nKey scriptures to study:\n";
                this.config.doctrines.salvation.keyVerses.forEach(verse => {
                    response += `â€¢ <span class="scripture-reference" onclick="showScripture('${verse}')">${verse}</span>\n`;
                });
                response += "\nThe most important verse is Acts 2:38, which shows both repentance and baptism are necessary for the remission of sins. Would you like to study any of these passages in detail?";
                return response;
            }

            explainBaptism() {
                return `Biblical baptism according to the New Testament:\n\n` +
                    `**Purpose**: ${this.config.doctrines.baptism.purpose}\n` +
                    `**Mode**: ${this.config.doctrines.baptism.mode}\n` +
                    `**Who**: ${this.config.doctrines.baptism.subjects}\n\n` +
                    `Key passages for study:\n` +
                    `â€¢ <span class="scripture-reference" onclick="showScripture('Acts 2:38')">Acts 2:38</span> - For remission of sins\n` +
                    `â€¢ <span class="scripture-reference" onclick="showScripture('Romans 6:3-4')">Romans 6:3-4</span> - Burial and resurrection\n` +
                    `â€¢ <span class="scripture-reference" onclick="showScripture('Galatians 3:27')">Galatians 3:27</span> - Put on Christ\n` +
                    `â€¢ <span class="scripture-reference" onclick="showScripture('1 Peter 3:21')">1 Peter 3:21</span> - Baptism saves\n\n` +
                    `Remember, baptism is not a work of merit but an act of obedient faith. Would you like to explore any specific aspect?`;
            }

            explainWorship() {
                let response = "New Testament worship consists of five acts:\n\n";
                this.config.doctrines.worship.elements.forEach(element => {
                    response += `â€¢ ${element}\n`;
                });
                response += `\n**Important note about music**: ${this.config.doctrines.worship.music}\n\n`;
                response += "The New Testament specifies singing, not playing instruments. ";
                response += "Ephesians 5:19 and Colossians 3:16 both emphasize making melody in the heart, not with mechanical instruments.\n\n";
                response += "Would you like scriptural support for any of these worship practices?";
                return response;
            }

            explainAcappella() {
                return `The New Testament pattern for worship music is a cappella (voice only) singing:\n\n` +
                    `**Biblical Evidence**:\n` +
                    `â€¢ <span class="scripture-reference" onclick="showScripture('Ephesians 5:19')">Ephesians 5:19</span> - "singing and making melody in your heart"\n` +
                    `â€¢ Colossians 3:16 - "singing with grace in your hearts"\n` +
                    `â€¢ The Greek word "psallo" means to sing, making melody in the heart\n\n` +
                    `**Historical Evidence**:\n` +
                    `â€¢ The early church sang without instruments for several centuries\n` +
                    `â€¢ Instruments were introduced much later, departing from the apostolic pattern\n\n` +
                    `**Principle**: We speak where the Bible speaks and are silent where it is silent. ` +
                    `Since the New Testament only authorizes singing, we don't add to God's pattern.\n\n` +
                    `This is about following God's will precisely as revealed. Would you like to study the Greek terms or historical evidence?`;
            }

            explainOrganization() {
                return `New Testament church organization:\n\n` +
                    `**Structure**: ${this.config.doctrines.organization.structure}\n\n` +
                    `**Leadership roles**:\n` +
                    this.config.doctrines.organization.leadership.map(role => `â€¢ ${role}`).join('\n') + '\n\n' +
                    `**Key principles**:\n` +
                    `â€¢ Each congregation is autonomous (self-governing)\n` +
                    `â€¢ No earthly headquarters or hierarchy\n` +
                    `â€¢ Christ is the only head of the church (Ephesians 1:22-23)\n` +
                    `â€¢ Elders oversee only their local congregation (1 Peter 5:2)\n\n` +
                    `This pattern prevents corruption and maintains scriptural purity. ` +
                    `Would you like to study the qualifications for any of these roles?`;
            }

            explainCommunion() {
                return `The Lord's Supper according to New Testament teaching:\n\n` +
                    `**When**: Every first day of the week (Sunday)\n` +
                    `â€¢ <span class="scripture-reference" onclick="showScripture('Acts 20:7')">Acts 20:7</span> - "Upon the first day of the week"\n\n` +
                    `**Elements**:\n` +
                    `â€¢ Unleavened bread - Christ's body (Matthew 26:26)\n` +
                    `â€¢ Fruit of the vine - Christ's blood (Matthew 26:27-28)\n\n` +
                    `**Purpose**:\n` +
                    `â€¢ Remember Christ's sacrifice (1 Corinthians 11:24-25)\n` +
                    `â€¢ Proclaim His death till He comes (1 Corinthians 11:26)\n` +
                    `â€¢ Commune with Christ and fellow Christians\n\n` +
                    `**Manner**:\n` +
                    `â€¢ Self-examination required (1 Corinthians 11:28)\n` +
                    `â€¢ Must discern the Lord's body (1 Corinthians 11:29)\n` +
                    `â€¢ Worthy manner to avoid condemnation\n\n` +
                    `This memorial is central to our worship each Lord's Day. Would you like to study the Corinthian passages about proper observance?`;
            }

            explainDivorce() {
                return `Marriage and divorce according to Christ's teaching:\n\n` +
                    `**God's Ideal**:\n` +
                    `â€¢ Marriage is a lifelong covenant (Matthew 19:6)\n` +
                    `â€¢ "What God has joined together, let not man separate"\n\n` +
                    `**Only Scriptural Cause for Divorce**:\n` +
                    `â€¢ Fornication/adultery by spouse (Matthew 19:9)\n` +
                    `â€¢ This is the only exception Christ gave\n\n` +
                    `**Remarriage**:\n` +
                    `â€¢ The innocent party may remarry after scriptural divorce\n` +
                    `â€¢ Others who remarry commit adultery (Luke 16:18)\n\n` +
                    `**Important Note**: This is a sensitive topic requiring careful study and wisdom. ` +
                    `Each situation is unique. I strongly recommend:\n` +
                    `â€¢ Deep personal study of Matthew 19:3-12\n` +
                    `â€¢ Consultation with your local elders\n` +
                    `â€¢ Prayer for wisdom and guidance\n\n` +
                    `Would you like to examine the specific passages together?`;
            }

            // Suggest relevant web references based on input
            suggestWebReferences(userInput) {
                const matches = [];
                const inputLower = userInput.toLowerCase();
                for (const page of this.config.referencePages) {
                    if (
                        (inputLower.includes("history") && page.title.toLowerCase().includes("history")) ||
                        (inputLower.includes("saved") && page.title.toLowerCase().includes("saved")) ||
                        (inputLower.includes("overview") && page.title.toLowerCase().includes("overview"))
                    ) {
                        matches.push(page);
                    }
                }
                if (matches.length === 0) return this.config.referencePages; // Show all if no match
                return matches;
            }

            provideGeneralHelp(userInput) {
                let response = `I understand you're asking about "${userInput}". Let me help you explore this biblically.\n\n` +
                    `For any Bible study, I recommend:\n\n` +
                    `1. **Read the context** - Never take verses in isolation\n` +
                    `2. **Compare scriptures** - Let the Bible interpret itself\n` +
                    `3. **Consider the audience** - Who was being addressed?\n` +
                    `4. **Apply properly** - Distinguish between cultural and eternal principles\n\n`;

                // Suggest relevant web pages
                const webPages = this.suggestWebReferences(userInput);
                if (webPages && webPages.length > 0) {
                    response += `You may also find these resources helpful:<br>`;
                    for (const page of webPages) {
                        response += `â€¢ <a href="${page.url}" target="_blank">${page.title}</a><br>`;
                    }
                    response += `<br>`;
                }

                response += `Could you be more specific about what aspect you'd like to study? For example:<br>` +
                    `â€¢ A particular passage you're studying<br>` +
                    `â€¢ A doctrinal question<br>` +
                    `â€¢ Sermon preparation help<br>` +
                    `â€¢ Historical or cultural context<br><br>` +
                    `I'm here to help you dig deeper into God's Word!`;
                return response;
            }
        }

        // Initialize the assistant
        const assistant = new BibleAssistant(botConfig);

        // UI interaction functions
        function sendMessage() {
            const input = document.getElementById('userInput');
            const message = input.value.trim();
            if (!message) return;
            addMessage(message, 'user');
            input.value = '';
            showTypingIndicator();
            setTimeout(async () => {
                const response = await assistant.processMessage(message);
                hideTypingIndicator();
                addMessage(response, 'bot');
            }, 1000);
        }

        function addMessage(text, sender) {
            const chatContainer = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            const bubble = document.createElement('div');
            bubble.className = 'bubble';
            bubble.innerHTML = text.replace(/\n/g, '<br>');
            messageDiv.appendChild(bubble);
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        function showTypingIndicator() {
            document.getElementById('typingIndicator').classList.add('active');
        }

        function hideTypingIndicator() {
            document.getElementById('typingIndicator').classList.remove('active');
        }

        function quickAction(topic) {
            const input = document.getElementById('userInput');
            const prompts = {
                'salvation': 'What does the Bible teach about salvation?',
                'baptism': 'Explain biblical baptism',
                'worship': 'What are the elements of New Testament worship?',
                'organization': 'How should the church be organized?',
                'communion': 'Tell me about the Lord\'s Supper'
            };
            input.value = prompts[topic];
            sendMessage();
        }

        // Show all trusted web references in chat
        function showWebReferences() {
            const pages = botConfig.referencePages.map(page =>
                `â€¢ <a href="${page.url}" target="_blank">${page.title}</a>`
            ).join('<br>');
            addMessage(`Here are trusted resources:<br>${pages}`, 'bot');
        }

        // Fetch full scripture from public Bible API (KJV)
        async function fetchScripture(reference) {
            // Prefer local snippet for instant lookup of frequently used references
            if (botConfig.scriptures[reference]) {
                return botConfig.scriptures[reference];
            }
            // Format: "John 3:16" => "John+3:16"
            const refForApi = encodeURIComponent(reference.replace(/\s+/g, '+'));
            try {
                const resp = await fetch(`https://bible-api.com/${refForApi}?translation=kjv`);
                if (!resp.ok) throw new Error("API error");
                const data = await resp.json();
                if (data && data.text) {
                    return data.text;
                }
                return "Scripture text not found (API).";
            } catch (e) {
                return "Scripture text could not be loaded from the online Bible API.";
            }
        }

        // Show scripture modal with full Bible verse from API
        async function showScripture(reference) {
            const modal = document.getElementById('scriptureModal');
            const content = document.getElementById('scriptureContent');
            content.innerHTML = `<h2>${reference}</h2>
                <p style="margin-top: 20px; line-height: 1.8; font-size: 18px;">
                    Loading scripture text...
                </p>
            `;
            modal.classList.add('active');
            const verseText = await fetchScripture(reference);
            content.innerHTML = `
                <h2>${reference}</h2>
                <p style="margin-top: 20px; line-height: 1.8; font-size: 18px;">
                    ${verseText}
                </p>
                <p style="margin-top: 20px; font-style: italic; color: #666;">
                    Powered by <a href="https://bible-api.com" target="_blank">Bible API</a> (KJV).
                </p>
            `;
        }

        function closeScriptureModal() {
            document.getElementById('scriptureModal').classList.remove('active');
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('scriptureModal');
            if (event.target == modal) {
                modal.classList.remove('active');
            }
        }
    </script>
</body>
</html>
